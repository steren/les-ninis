<!DOCTYPE html>
<html lang="en">
<head>
	<title>Tables</title>
	<meta charset="utf-8">

	<link rel="icon" sizes="192x192" href="favicon-192.png">
  	<link rel="icon" sizes="32x32"   href="favicon-32.png" >

	<link href='http://fonts.googleapis.com/css?family=Poiret+One' rel='stylesheet' type='text/css'>
	<style>

		body {
			background-color: white;
			margin: 0px;
			overflow: hidden;

			--canvasWidth: 1440px;
			--canvasHeight: 800px;
		}

		#settings {
			position: absolute;
			bottom: 0;
			right: 0;
			opacity: 0.1;
			font-size: 2em;
			cursor: pointer;
			margin-right: 10px;
		}

		#paint-canvas {
			position: absolute;
			top: 0;
			left: 0;
			width: var(--canvasWidth);
			height: var(--canvasHeight);
		}

		#nogo {
			--tableWidth: 140px;
			--tableHeight: 300px;
			width: var(--tableWidth);
  			height: var(--tableHeight);
  			left: calc(var(--canvasWidth) / 2 - var(--tableWidth) / 2);
  			top: calc(var(--canvasHeight) / 2 - var(--tableHeight) / 2);
  			position: absolute;
		}

	</style>
</head>
<body>
	<canvas id="paint-canvas"></canvas>

	<div id="nogo"></div>

	<div id="settings">&#9881;</div>

	<script src="attractors/lib/dat.gui.min.js"></script>	
	<script src="attractors/lib/opentype.min.js"></script>


	<script type="text/javascript">

	  var radiusTable = 100;
		
	  // A1 is 841 cm x 594 cm

	  var screenWidth = 1440; // 841 cm  
	  var screenHeight = 800; // 594 cm

	  var tableWidth = 140;
	  var tableHeight = 300;

	  var impactDistance = 80;
	  var type = 'cos';

	  var config = {
	  		  id: 'paint-canvas',
	  		  init_scale: 3,
 			  text: '',
			  text_position_x: 0,
			  text_position_y: 0,
			  text_width_ratio: 0,
			  background_color: '#a8c5cf',
			  nb_attractors: 140,
			  particule_density: 2000,
			  line_width: 0.5,
			  color1: '#DBCEC1',
			  color2: '#F7F6F5',
			  pixelratio: window.devicePixelRatio,
			  svg: false,
			  one_path: false,
			  shadow_scale: 0.7,
			  nogo_zone: true,
			  nogoZoneType : 'cos',
			  noGoImpactDistance : impactDistance,
			  nogoCircles : [
			  // left
			  	// 0, 0
			  {
			  	x: screenWidth * 1 / 10,
			  	y: screenHeight / 2 - tableHeight / 2,
			  	radius: radiusTable,
			  	impactDistance: impactDistance,
			  	type: type,
			  	direction: 1,
			  },{
			  	// 1, 1
			  	x: screenWidth * 3 / 10,
			  	y: screenHeight / 2 + tableHeight / 2,
			  	radius: radiusTable,
			  	impactDistance: impactDistance,
			  	type: type,
			  	direction: 1,
			  }, {
			  	// 0, 1
			  	x: screenWidth * 1 / 10,
			  	y: screenHeight / 2 + tableHeight / 2,
			  	radius: radiusTable,
			  	impactDistance: impactDistance,
			  	type: type,
			  	direction: -1,
			  }, {
			  	// 1, 0
			  	x: screenWidth * 3 / 10,
			  	y: screenHeight / 2 - tableHeight / 2,
			  	radius: radiusTable,
			  	impactDistance: impactDistance,
			  	type: type,
			  	direction: -1,
			  }, 

			  // right
		  	  {
		  	  	// 0,0
			  	x: screenWidth * 7 / 10,
			  	y: screenHeight / 2 - tableHeight / 2,
			  	radius: radiusTable,
			  	impactDistance: impactDistance,
			  	type: type,
			  	direction: 1,
			  },{
			  	// 1, 1
			  	x: screenWidth * 9 / 10,
			  	y: screenHeight / 2 + tableHeight / 2,
			  	radius: radiusTable,
			  	impactDistance: impactDistance,
			  	type: type,
			  	direction: 1,
			  }, {
			  	// 0, 1
			  	x: screenWidth * 7 / 10,
			  	y: screenHeight / 2 + tableHeight / 2,
			  	radius: radiusTable,
			  	impactDistance: impactDistance,
			  	type: type,
			  	direction: -1,
			  }, {
			  	// 1, 0
			  	x: screenWidth * 9 / 10,
			  	y: screenHeight / 2 - tableHeight / 2,
			  	radius: radiusTable,
			  	impactDistance: impactDistance,
			  	type: type,
			  	direction: -1,
			  }, 
			  ],
			  root: 'attractors/'
			}
	</script>	
	<script src="attractors/ninis.js"></script>


	<script type="text/javascript">
	// Refresh on click and fetch keys

		function refreshGUI() {
		  console.log(textInput);
  		  textInput.updateDisplay();
		}

		function onKeyUp(e) {
		  if (e.which == 13) { // Enter
			init();
		  } else if (e.which == 8) { // Backspace
			return;
		  } else if (e.which == 27) { // Escape
			config.text = '';
			init();
		  } else { // any char or space
			var typedChar = String.fromCharCode(e.which);
			if(typedChar.match(/[a-zA-Z\s/]/)) {
			  config.text += typedChar;
			  init();
			}
		  }
		  refreshGUI();
		}

		function onKeyDown(e) {
		  if(e.which == 8) { // Backspace
			 config.text = config.text.slice(0, -1);
			 init();
			 // if we are in an input, do not preventDefault
			 if(event.target.tagName.toUpperCase() != 'INPUT') {
			 	e.preventDefault();
			 }
		  }
		  refreshGUI();
		}
		document.body.addEventListener('keyup', onKeyUp);
		document.body.addEventListener('keydown', onKeyDown);

		document.getElementById("paint-canvas").addEventListener('click', init, true);
	</script>


	<script type="text/javascript">
	// get the position and size of the "nogo" element.
		function getNoGoElParam() {
			var nogoEl = document.getElementById('nogo');
			return {
				x: nogoEl.offsetLeft,
				y: nogoEl.offsetTop,
				width: nogoEl.offsetWidth,
				height: nogoEl.offsetHeight
			}
		}

		function initWithNoGo() {
			config.nogoParam = getNoGoElParam();
			init();
		}

		initWithNoGo();
		
	</script>

	<script type="text/javascript">
	// dat.GUI controls
	  var gui = new dat.GUI();
	  gui.domElement.style.visibility = 'hidden';
	  dat.GUI.toggleHide();
	  gui.remember(config);

	  gui.addColor(config, 'background_color').onChange(init);
	  gui.add(config, 'nb_attractors', 0, 500).onChange(init);
	  gui.add(config, 'particule_density', 0, 3000).onChange(init);
	  gui.add(config, 'init_scale', 0.01, 1.5).onChange(init);
	  gui.add(config, 'nogo_zone').onChange(initWithNoGo);

	  var textFolder = gui.addFolder('Text');
	  var textInput = textFolder.add(config, 'text').onChange(init);
	  textFolder.add(config, 'text_width_ratio', 0, 50).onChange(init);
	  textFolder.add(config, 'text_position_x', 0, 100).onChange(init);
	  textFolder.add(config, 'text_position_y', 0, 100).onChange(init);

	  var lineFolder = gui.addFolder('Lines');
	  lineFolder.add(config, 'line_width', 0, 5).onChange(init);
	  lineFolder.addColor(config, 'color1').onChange(init);
	  lineFolder.addColor(config, 'color2').onChange(init);

	  var lineFolder = gui.addFolder('Shadows');
	  lineFolder.add(config, 'shadow_scale', 0, 5).onChange(init);

	  var advancedFolder = gui.addFolder('Advanced');
	  advancedFolder.add(config, 'pixelratio', 1, 10).onChange(init);
	  advancedFolder.add(config, 'svg').onChange(init);
	  advancedFolder.add(config, 'one_path').onChange(init);
	  advancedFolder.add({save_svg:false}, 'save_svg').onChange(generateSVG);

	  document.getElementById("settings").addEventListener('click', function() {
	  	gui.domElement.style.visibility = 'visible';
	    dat.GUI.toggleHide();
	  });
	</script>
</body>
</html>
